<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.4</version>
    <template_groups>
        <template_group>
            <uuid>36bff6c29af64692839d077febfc7079</uuid>
            <name>Templates/Network devices</name>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <uuid>9b39c05fea6243798cbfabb339cecbf0</uuid>
            <template>FritzBox UPNP</template>
            <name>FritzBox UPNP</name>
            <description>Retrieves informations from a AVM-FritzBox via UPNP</description>
            <groups>
                <group>
                    <name>Templates/Network devices</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>5305d07fcb3441b1aca49e820749a747</uuid>
                    <name>Network devices</name>
                    <type>SCRIPT</type>
                    <key>fritz.lua.devices</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

// Encode string as UTF-16LE
function encodeStr(text) {
var byteArray = new Uint8Array(text.length * 2);
    for (var i = 0; i &lt; text.length; i++) {
        byteArray[i*2] = text.charCodeAt(i) // &amp; 0xff;
        byteArray[i*2+1] = text.charCodeAt(i) &gt;&gt; 8 // &amp; 0xff;
    }
    return byteArray;
}

// Get challenge from Fritz!Box
var url = 'http://' + params.ip + '/login_sid.lua';
const request = new HttpRequest();
var response = request.get(url);

// Calculate request parameters
const challenge = XML.query(response, '/SessionInfo/Challenge/text()');
const challengeStr = encodeStr(challenge + '-' + params.password);
const challengeResponse = challenge + '-' + md5(challengeStr);

// Get session id from Fritz!Box
url = url + '?username=' + params.username + '&amp;response=' + challengeResponse;
response = request.get(url);
const sid = XML.query(response, '/SessionInfo/SID/text()');

if (sid != '0000000000000000') {
    // Retrieve data excerpt from Fritz!Box
    // (name,ip,mac,UID,dhcp,wlan,ethernet,active,static_dhcp,manu_name,wakeup,deleteable,source,online,speed,wlan_UIDs,auto_wakeup,guest,url,wlan_station_type,vendorname,parentname,parentuid,ethernet_port,wlan_show_in_monitor,plc,ipv6_ifid,parental_control_abuse)
    url = 'http://' + params.ip + '/query.lua?sid=' + sid + '&amp;network=landevice:settings/landevice/list(name,ip,mac,active,online,guest)';
    response = request.get(url);

    // Terminate Session as the number of active sessions is limited
    // and a session expires after 20 minutes
    url = 'http://' + params.ip + '/login_sid.lua?logout=1&amp;sid=' + sid;
    request.get(url);

    // Return the response
    return JSON.stringify(JSON.parse(response));
} else {
    return 'Invalid SID';
}</params>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>7443557dadd34aaa8ae652329b8fc103</uuid>
                    <name>Network devices (active)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.active</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.active==1)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>f2ec7258800942edabb6f95113e5d8e8</uuid>
                    <name>Network devices (all)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.all</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network.length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5bdc68ee9ff24d62a5a047e2fc3af4f7</uuid>
                    <name>Network devices (guest)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.guest</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.guest==1)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>6e429e5068eb48cfb934b29aa4383462</uuid>
                    <name>Network devices (inactive)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.inactive</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.active==0)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>c4d73e83e9644f49afd897c573704936</uuid>
                    <name>Network devices (online)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.online</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.online==1)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>58fcfdb5525e44488763116cbde1dec7</uuid>
                    <name>Eventlog</name>
                    <type>SCRIPT</type>
                    <key>fritz.lua.eventlog</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

// Encode string as UTF-16LE
function encodeStr(text) {
var byteArray = new Uint8Array(text.length * 2);
    for (var i = 0; i &lt; text.length; i++) {
        byteArray[i*2] = text.charCodeAt(i) // &amp; 0xff;
        byteArray[i*2+1] = text.charCodeAt(i) &gt;&gt; 8 // &amp; 0xff;
    }
    return byteArray;
}

// Get challenge from Fritz!Box
var url = 'http://' + params.ip + '/login_sid.lua';
const request = new HttpRequest();
var response = request.get(url);

// Calculate request parameters
const challenge = XML.query(response, '/SessionInfo/Challenge/text()');
const challengeStr = encodeStr(challenge + '-' + params.password);
const challengeResponse = challenge + '-' + md5(challengeStr);

// Get session id from Fritz!Box
url = url + '?username=' + params.username + '&amp;response=' + challengeResponse;
response = request.get(url);
const sid = XML.query(response, '/SessionInfo/SID/text()');

if (sid != '0000000000000000') {
    // Retrieve data excerpt from Fritz!Box
    url = 'http://' + params.ip + '/query.lua?sid=' + sid + '&amp;mq_log=logger:status/log';
    response = request.get(url);

    // Terminate Session as the number of active sessions is limited
    // and a session expires after 20 minutes
    url = 'http://' + params.ip + '/login_sid.lua?logout=1&amp;sid=' + sid;
    request.get(url);

    // Return the response
    return JSON.stringify(JSON.parse(response));
} else {
    return 'Invalid SID';
}</params>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>d2f5d4e098cd4acf9c45b9a12f2f1da7</uuid>
                    <name>Manufacturer</name>
                    <type>DEPENDENT</type>
                    <key>fritz.manufacturer</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>VENDOR</inventory_link>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.root.device.manufacturer</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.systeminfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>xml</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>22f21e68687241e08bdf9b950893d026</uuid>
                    <name>Model Name</name>
                    <type>DEPENDENT</type>
                    <key>fritz.modelname</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>MODEL</inventory_link>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.root.device.modelName</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.systeminfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>xml</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>049220eb2f894d7794ac99f1920bab84</uuid>
                    <name>ProviderName</name>
                    <type>DEPENDENT</type>
                    <key>fritz.provider.name</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.BoxInfo.ProviderName</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.boxinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>xml</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>0a56aa8eb2374b0f8af56e4c28bb35c2</uuid>
                    <name>System Version</name>
                    <type>DEPENDENT</type>
                    <key>fritz.systemversion</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.root.systemVersion.Display</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.systeminfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>xml</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b88fc6a1526a4e5fb2d5da0575f4baef</uuid>
                    <name>Number of ports forwarded</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.ports.forwarded</key>
                    <delay>5m</delay>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(XML.query(response, 'number(//NewForwardNumberOfEntries/text())'));
    }
}</params>
                    <description>Retrieves the number of forwarded ports of a Fritz!Box</description>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetForwardNumberOfEntries</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/layer3forwarding</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:Layer3Forwarding:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5eeead30628041a19815f473e1f3d626</uuid>
                    <name>Access type</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.accesstype</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewWANAccessType</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>72655bad5a2a4aeba63e3e8dddd2d1a7</uuid>
                    <name>Last connection error</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.connectionerror</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetStatusInfoResponse.NewLastConnectionError</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.statusinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>8a70c79eeb9e497b92bb4614fbbc644e</uuid>
                    <name>Connection status</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.connectionstatus</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetStatusInfoResponse.NewConnectionStatus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.statusinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>715c91e4a96944bbb28cbc1bc80b2d46</uuid>
                    <name>Connection type</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.connectiontype</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetConnectionTypeInfoResponse.NewConnectionType</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.connectiontypeinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>88fc5adbc07a48aeaab32745d690c563</uuid>
                    <name>Downstream</name>
                    <type>CALCULATED</type>
                    <key>fritz.upnp.downstream</key>
                    <units>B</units>
                    <params>change(//fritzbox.upnp.totalbytesreceived)</params>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5bfe846ac34c496a8e97d3b50187402d</uuid>
                    <name>Downstream max bit</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.downstreammaxbit</key>
                    <delay>0</delay>
                    <units>b</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewLayer1DownstreamMaxBitRate</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>472eaac8e93e425ea68db0dea61ab5bc</uuid>
                    <name>Link status</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.linkstatus</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewPhysicalLinkStatus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>46ffd3633a2f4105bfac74ba6b18909f</uuid>
                    <name>Upstream</name>
                    <type>CALCULATED</type>
                    <key>fritz.upnp.upstream</key>
                    <units>B</units>
                    <params>change(//fritzbox.upnp.totalbytessent)</params>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9cd56b644810479e9cc5de35d457edea</uuid>
                    <name>Upstream max bit</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.upstreammaxbit</key>
                    <delay>0</delay>
                    <units>b</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewLayer1UpstreamMaxBitRate</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e35696f0701349a0b279205322dc9b9c</uuid>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>fritz.upnp.uptime</key>
                    <delay>0</delay>
                    <units>s</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetStatusInfoResponse.NewUptime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritzbox.upnp.statusinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>0ec53c12b15346508b35453f6f100832</uuid>
                    <name>Boxinfo</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.boxinfo</key>
                    <delay>1h</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>q:</parameter>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}/juis_boxinfo.xml</url>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>xml</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2a547c31e876414880861d11fcd24b49</uuid>
                    <name>Systeminfo</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.systeminfo</key>
                    <delay>1h</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/tr64desc.xml</url>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>xml</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>eacdac4f59d4454a9cf8f5a6e0db65b4</uuid>
                    <name>Connection type info</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.connectiontypeinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wanipconn1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetStatusInfo xmlns:u=&quot;urn:schemas-upnp-org:service:WANIPConnection:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANIPConnection:1#GetConnectionTypeInfo</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>8aa884a62b5440438f63767f22c088ce</uuid>
                    <name>External IP-Address</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.externalip</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetExternalIPAddressResponse.NewExternalIPAddress</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wanipconn1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetStatusInfo xmlns:u=&quot;urn:schemas-upnp-org:service:WANIPConnection:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANIPConnection:1#GetExternalIPAddress</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>bad88a44b1b841aa863bf37193d6de25</uuid>
                            <expression>changecount(/FritzBox UPNP/fritzbox.upnp.externalip,1)&gt;0</expression>
                            <name>External address changed</name>
                            <priority>AVERAGE</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>e9c819ff39824fe99fcee367db688a5e</uuid>
                    <name>Host number of entries</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.host.entries</key>
                    <history>0</history>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetHostNumberOfEntriesResponse.NewHostNumberOfEntries</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/upnp/control/hosts</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;
xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; &gt;
 &lt;s:Header&gt;
 &lt;h:InitChallenge
 xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot;
 s:mustUnderstand=&quot;1&quot;&gt;
 &lt;UserID&gt;{$FRITZ.USERNAME}&lt;/UserID&gt;
 &lt;/h:InitChallenge &gt;
 &lt;/s:Header&gt;
 &lt;s:Body&gt;
 &lt;u:GetHostNumberOfEntries xmlns:u=&quot;urn:dslforum-org:service:Hosts:1&quot;&gt;
 &lt;/u:GetHostNumberOfEntries&gt;
 &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:dslforum-org:service:Hosts:1#GetHostNumberOfEntries</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>645801a1720548989a8b61e68ed6f42b</uuid>
                    <name>Host list</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.hostlist</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <url>http://{HOST.IP}:49000/upnp/control/hosts</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetStatusInfo xmlns:u=&quot;urn:dslforum-org:service:Hosts:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <status_codes>200, 401</status_codes>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:dslforum-org:service:Hosts:1#X_AVM-DE_GetHostListPath</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <retrieve_mode>HEADERS</retrieve_mode>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>116b910e1cb74e519bc414f629dd43f1</uuid>
                    <name>Link properties</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.linkproperties</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wancommonifc1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetCommonLinkProperties xmlns:u=&quot;urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1#GetCommonLinkProperties</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2a39c9af6dc043728704bab94f7741ee</uuid>
                    <name>Status Info</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.statusinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wanipconn1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetStatusInfo xmlns:u=&quot;urn:schemas-upnp-org:service:WANIPConnection:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANIPConnection:1#GetStatusInfo</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>3ac92308dee8454eb20ca1478d501b3c</uuid>
                    <name>Total bytes received</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.totalbytesreceived</key>
                    <units>B</units>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetTotalBytesReceivedResponse.NewTotalBytesReceived</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wancommonifc1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetTotalBytesReceived xmlns:u=&quot;urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1#GetTotalBytesReceived</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>78763880312f45dcac95991be2fa258c</uuid>
                    <name>Total bytes sent</name>
                    <type>HTTP_AGENT</type>
                    <key>fritzbox.upnp.totalbytessent</key>
                    <units>B</units>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetTotalBytesSentResponse.NewTotalBytesSent</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wancommonifc1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetTotalBytesSent xmlns:u=&quot;urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1#GetTotalBytesSent</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>upnp</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <macros>
                <macro>
                    <macro>{$FRITZ.PASSWORD}</macro>
                    <type>SECRET_TEXT</type>
                    <description>Password in FritzBox!</description>
                </macro>
                <macro>
                    <macro>{$FRITZ.USERNAME}</macro>
                    <description>Username in FritzBox!</description>
                </macro>
            </macros>
        </template>
    </templates>
    <graphs>
        <graph>
            <uuid>f9790a03ba5d42debd53cae241cdacc8</uuid>
            <name>Devices</name>
            <type>STACKED</type>
            <graph_items>
                <graph_item>
                    <color>F7941D</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.guest</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.inactive</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>199C0D</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.active</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>3</sortorder>
                    <color>2774A4</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.online</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>f621cdc7edea41e3a20b74ab4b6420ee</uuid>
            <name>Up- / Downstream</name>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <calc_fnc>ALL</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.upnp.downstream</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <calc_fnc>ALL</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.upnp.upstream</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
