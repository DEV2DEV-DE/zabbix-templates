<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.4</version>
    <template_groups>
        <template_group>
            <uuid>36bff6c29af64692839d077febfc7079</uuid>
            <name>Templates/Network devices</name>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <uuid>9b39c05fea6243798cbfabb339cecbf0</uuid>
            <template>FritzBox UPNP</template>
            <name>FritzBox UPNP</name>
            <description>Retrieves informations from a AVM-FritzBox via UPNP</description>
            <groups>
                <group>
                    <name>Templates/Network devices</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>5305d07fcb3441b1aca49e820749a747</uuid>
                    <name>Network devices</name>
                    <type>SCRIPT</type>
                    <key>fritz.lua.devices</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

// Encode string as UTF-16LE
function encodeStr(text) {
var byteArray = new Uint8Array(text.length * 2);
    for (var i = 0; i &lt; text.length; i++) {
        byteArray[i*2] = text.charCodeAt(i) // &amp; 0xff;
        byteArray[i*2+1] = text.charCodeAt(i) &gt;&gt; 8 // &amp; 0xff;
    }
    return byteArray;
}

// Get challenge from Fritz!Box
var url = 'http://' + params.ip + '/login_sid.lua';
const request = new HttpRequest();
var response = request.get(url);

// Calculate request parameters
const challenge = XML.query(response, '/SessionInfo/Challenge/text()');
const challengeStr = encodeStr(challenge + '-' + params.password);
const challengeResponse = challenge + '-' + md5(challengeStr);

// Get session id from Fritz!Box
url = url + '?username=' + params.username + '&amp;response=' + challengeResponse;
response = request.get(url);
const sid = XML.query(response, '/SessionInfo/SID/text()');

if (sid != '0000000000000000') {
    // Retrieve data excerpt from Fritz!Box
    // (name,ip,mac,UID,dhcp,wlan,ethernet,active,static_dhcp,manu_name,wakeup,deleteable,source,online,speed,wlan_UIDs,auto_wakeup,guest,url,wlan_station_type,vendorname,parentname,parentuid,ethernet_port,wlan_show_in_monitor,plc,ipv6_ifid,parental_control_abuse)
    url = 'http://' + params.ip + '/query.lua?sid=' + sid + '&amp;network=landevice:settings/landevice/list(name,ip,mac,active,online,guest)';
    response = request.get(url);

    // Terminate Session as the number of active sessions is limited
    // and a session expires after 20 minutes
    url = 'http://' + params.ip + '/login_sid.lua?logout=1&amp;sid=' + sid;
    request.get(url);

    // Return the response
    return JSON.stringify(JSON.parse(response));
} else {
    return 'Invalid SID';
}</params>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>7443557dadd34aaa8ae652329b8fc103</uuid>
                    <name>Network devices (active)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.active</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.active==1)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>f2ec7258800942edabb6f95113e5d8e8</uuid>
                    <name>Network devices (all)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.all</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network.length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5bdc68ee9ff24d62a5a047e2fc3af4f7</uuid>
                    <name>Network devices (guest)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.guest</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.guest==1)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>6e429e5068eb48cfb934b29aa4383462</uuid>
                    <name>Network devices (inactive)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.inactive</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.active==0)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>c4d73e83e9644f49afd897c573704936</uuid>
                    <name>Network devices (online)</name>
                    <type>DEPENDENT</type>
                    <key>fritz.lua.devices.online</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.network[?(@.online==1)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.lua.devices</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>58fcfdb5525e44488763116cbde1dec7</uuid>
                    <name>Eventlog</name>
                    <type>SCRIPT</type>
                    <key>fritz.lua.eventlog</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

// Encode string as UTF-16LE
function encodeStr(text) {
var byteArray = new Uint8Array(text.length * 2);
    for (var i = 0; i &lt; text.length; i++) {
        byteArray[i*2] = text.charCodeAt(i) // &amp; 0xff;
        byteArray[i*2+1] = text.charCodeAt(i) &gt;&gt; 8 // &amp; 0xff;
    }
    return byteArray;
}

// Get challenge from Fritz!Box
var url = 'http://' + params.ip + '/login_sid.lua';
const request = new HttpRequest();
var response = request.get(url);

// Calculate request parameters
const challenge = XML.query(response, '/SessionInfo/Challenge/text()');
const challengeStr = encodeStr(challenge + '-' + params.password);
const challengeResponse = challenge + '-' + md5(challengeStr);

// Get session id from Fritz!Box
url = url + '?username=' + params.username + '&amp;response=' + challengeResponse;
response = request.get(url);
const sid = XML.query(response, '/SessionInfo/SID/text()');

if (sid != '0000000000000000') {
    // Retrieve data excerpt from Fritz!Box
    url = 'http://' + params.ip + '/query.lua?sid=' + sid + '&amp;mq_log=logger:status/log';
    response = request.get(url);

    // Terminate Session as the number of active sessions is limited
    // and a session expires after 20 minutes
    url = 'http://' + params.ip + '/login_sid.lua?logout=1&amp;sid=' + sid;
    request.get(url);

    // Return the response
    return JSON.stringify(JSON.parse(response));
} else {
    return 'Invalid SID';
}</params>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>lua</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>0664c79eb0724e919484300cd3a181e3</uuid>
                    <name>External IP-Address</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064-appsetup.external-ip</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetAppRemoteInfoResponse.NewExternalIPAddress</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.appsetup.geremotetinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>bad88a44b1b841aa863bf37193d6de25</uuid>
                            <expression>changecount(/FritzBox UPNP/fritz.tr-064-appsetup.external-ip,1)&gt;0</expression>
                            <name>External address changed</name>
                            <priority>AVERAGE</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>dc7dc1ef4f624d3bb9eeedf11ff5191f</uuid>
                    <name>MyFritz enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064-appsetup.myfritz</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetAppRemoteInfoResponse.NewMyFritzEnabled</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.appsetup.geremotetinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5eeead30628041a19815f473e1f3d626</uuid>
                    <name>Access type</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.accesstype</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewWANAccessType</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>121cdbb71e164feaa1bd409a840b49f4</uuid>
                    <name>AppSetup-GetRemoteInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.appsetup.geremotetinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>VPN and remote access.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetAppRemoteInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/x_appsetup</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:X_AVM-DE_AppSetup:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>a48404155cca430bb7cae81acc3de695</uuid>
                    <name>Device-GetInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.device.getinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>Product- and device informations.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/deviceinfo</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:DeviceInfo:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>1ddf147a09ce48c487978eda402d3120</uuid>
                    <name>Manufacturer</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.device.manufacturer</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>VENDOR</inventory_link>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewManufacturerName</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.device.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>f6154054028948249f09ef4f00696e26</uuid>
                    <name>Model name</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.device.modelname</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>MODEL</inventory_link>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewModelName</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.device.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>4eda116fd0c3477ca4e5aa680bdfcbad</uuid>
                    <name>Serial number</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.device.serialnumber</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>SERIALNO_A</inventory_link>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewSerialNumber</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.device.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b6a8dea46b29425583e3d10dc3adbb64</uuid>
                    <name>Uptime</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.device.uptime</key>
                    <delay>0</delay>
                    <units>s</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewUpTime</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.device.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>0671ff82e3e54d3487db32d4fd6793a4</uuid>
                    <name>Software version</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.device.version</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <inventory_link>SOFTWARE</inventory_link>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewSoftwareVersion</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>const array = value.split('.');
return array[1] + '.' + array[2];</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.device.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>88fc5adbc07a48aeaab32745d690c563</uuid>
                    <name>Downstream</name>
                    <type>CALCULATED</type>
                    <key>fritz.tr-064.downstream</key>
                    <units>B</units>
                    <params>change(//fritz.tr-064.totalbytesreceived)</params>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5bfe846ac34c496a8e97d3b50187402d</uuid>
                    <name>Downstream max bit</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.downstreammaxbit</key>
                    <delay>0</delay>
                    <units>b</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewLayer1DownstreamMaxBitRate</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>775cbf2a9a7d4104a0b0320acb9c3ba2</uuid>
                    <name>Enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.ethconfig.enabled</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewEnable</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.ethconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b301d939c38e4da49c9d96f3dd141b68</uuid>
                    <name>EthernetConfig-GetInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.ethconfig.getinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>GetInfo about  ethernet interface.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/lanethernetifcfg</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:LANEthernetInterfaceConfig:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>f9355f2366b346d9a6f67f7366fedcd9</uuid>
                    <name>Status</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.ethconfig.status</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewStatus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.ethconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e9c819ff39824fe99fcee367db688a5e</uuid>
                    <name>Host number of entries</name>
                    <type>HTTP_AGENT</type>
                    <key>fritz.tr-064.host.entries</key>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetHostNumberOfEntriesResponse.NewHostNumberOfEntries</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/upnp/control/hosts</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;
xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; &gt;
 &lt;s:Header&gt;
 &lt;h:InitChallenge
 xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot;
 s:mustUnderstand=&quot;1&quot;&gt;
 &lt;UserID&gt;{$FRITZ.USERNAME}&lt;/UserID&gt;
 &lt;/h:InitChallenge &gt;
 &lt;/s:Header&gt;
 &lt;s:Body&gt;
 &lt;u:GetHostNumberOfEntries xmlns:u=&quot;urn:dslforum-org:service:Hosts:1&quot;&gt;
 &lt;/u:GetHostNumberOfEntries&gt;
 &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:dslforum-org:service:Hosts:1#GetHostNumberOfEntries</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>645801a1720548989a8b61e68ed6f42b</uuid>
                    <name>Host list</name>
                    <type>HTTP_AGENT</type>
                    <key>fritz.tr-064.hostlist</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <url>http://{HOST.IP}:49000/upnp/control/hosts</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetStatusInfo xmlns:u=&quot;urn:dslforum-org:service:Hosts:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <status_codes>200, 401</status_codes>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:dslforum-org:service:Hosts:1#X_AVM-DE_GetHostListPath</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <retrieve_mode>HEADERS</retrieve_mode>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>f2cd24a1fed54b33b5f1d81bffdacc9a</uuid>
                    <name>DHCP configurable</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.lan.dhcpconfigurable</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewDHCPServerConfigurable</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.lanconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>83ef98341e874a7da33428f1eaf3384e</uuid>
                    <name>DHCP enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.lan.dhcpenabled</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewDHCPServerEnable</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.lanconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>894e3b15a0664f85b7a3f59b7057d72c</uuid>
                    <name>DNS server</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.lan.dnsserver</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewDNSServers</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.lanconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>35ac6235d4c245679a9af4fcd2995257</uuid>
                    <name>LANConfig-GetInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.lanconfig.getinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>GetInfo about  LAN configurations.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/lanhostconfigmgm</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:LANHostConfigManagement:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>116b910e1cb74e519bc414f629dd43f1</uuid>
                    <name>Link properties</name>
                    <type>HTTP_AGENT</type>
                    <key>fritz.tr-064.linkproperties</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wancommonifc1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetCommonLinkProperties xmlns:u=&quot;urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1#GetCommonLinkProperties</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>472eaac8e93e425ea68db0dea61ab5bc</uuid>
                    <name>Link status</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.linkstatus</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewPhysicalLinkStatus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b88fc6a1526a4e5fb2d5da0575f4baef</uuid>
                    <name>Number of ports forwarded</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.ports.forwarded</key>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(XML.query(response, 'number(//NewForwardNumberOfEntries/text())'));
    }
}</params>
                    <description>Retrieves the number of forwarded ports.</description>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetForwardNumberOfEntries</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/layer3forwarding</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:Layer3Forwarding:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>bd2ef0b5aa654a87a57a5fff5ad2eb78</uuid>
                            <expression>last(/FritzBox UPNP/fritz.tr-064.ports.forwarded)&gt;0</expression>
                            <name>Number of ports forwarded</name>
                            <priority>HIGH</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>e2f7c12671b74cfdabcb545783b7e610</uuid>
                    <name>Enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.remoteaccess.enabled</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewEnabled</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.remoteaccess.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>f55893c9ad264f2b9f1b35c89c8446b5</uuid>
                    <name>Remote access</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.remoteaccess.getinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>DynDNS, remote servicing.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/x_remote</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:X_AVM-DE_RemoteAccess:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>d557450b8053471e917eb1b8c3712e45</uuid>
                    <name>LetsEncrypt enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.remoteaccess.letsencrypt</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewLetsEncryptEnabled</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.remoteaccess.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e5ea7f9484314e5d89c3de56e41d8ca5</uuid>
                    <name>Port</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.remoteaccess.port</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewPort</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.remoteaccess.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>dc23ca82611a41b3baf0a5b0759ac21c</uuid>
                    <name>FTP enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.storage.ftpenabled</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewFTPEnable</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.storage.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>080915ec651b4562a56827fdf846de75</uuid>
                    <name>FTP WAN enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.storage.ftpwanenabled</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewFTPWANEnable</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.storage.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>3cfaca932cb9453ba0720c0fbcf27e77</uuid>
                    <name>FTP WAN Port</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.storage.ftpwanport</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewFTPWANPort</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.storage.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e68534a8fb64416db81c7066b54c4452</uuid>
                    <name>FTP WAN SSL</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.storage.ftpwanssl</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewFTPWANSSLOnly</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.storage.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>d5a9436d3edc40e5b2eb3289d2f9bd4a</uuid>
                    <name>Storage-GetInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.storage.getinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>Settings for SMB, FTP.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/x_storage</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:X_AVM-DE_Storage:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>7ed7d414f2ad4dd08a5a7b9f745f734e</uuid>
                    <name>SMB enabled</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.storage.smbenabled</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewSMBEnable</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.storage.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>3ac92308dee8454eb20ca1478d501b3c</uuid>
                    <name>Total bytes received</name>
                    <type>HTTP_AGENT</type>
                    <key>fritz.tr-064.totalbytesreceived</key>
                    <units>B</units>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetTotalBytesReceivedResponse.NewTotalBytesReceived</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wancommonifc1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetTotalBytesReceived xmlns:u=&quot;urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1#GetTotalBytesReceived</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>78763880312f45dcac95991be2fa258c</uuid>
                    <name>Total bytes sent</name>
                    <type>HTTP_AGENT</type>
                    <key>fritz.tr-064.totalbytessent</key>
                    <units>B</units>
                    <authtype>BASIC</authtype>
                    <username>{$FRITZ.USERNAME}</username>
                    <password>{$FRITZ.PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetTotalBytesSentResponse.NewTotalBytesSent</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <url>http://{HOST.IP}:49000/igdupnp/control/wancommonifc1</url>
                    <posts>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
    &lt;s:Body&gt;
        &lt;u:GetTotalBytesSent xmlns:u=&quot;urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1&quot; /&gt;
    &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</posts>
                    <post_type>XML</post_type>
                    <headers>
                        <header>
                            <name>SoapAction</name>
                            <value>urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1#GetTotalBytesSent</value>
                        </header>
                        <header>
                            <name>Content-Type</name>
                            <value>text/xml; charset=&quot;utf-8&quot;</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>46ffd3633a2f4105bfac74ba6b18909f</uuid>
                    <name>Upstream</name>
                    <type>CALCULATED</type>
                    <key>fritz.tr-064.upstream</key>
                    <units>B</units>
                    <params>change(//fritz.tr-064.totalbytessent)</params>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9cd56b644810479e9cc5de35d457edea</uuid>
                    <name>Upstream max bit</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.upstreammaxbit</key>
                    <delay>0</delay>
                    <units>b</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetCommonLinkPropertiesResponse.NewLayer1UpstreamMaxBitRate</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.linkproperties</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5fd6be3615ca4a879c0338ddff8a214f</uuid>
                    <name>Provider name</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.wanciconfig.provider</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>Active internet provider.</description>
                    <preprocessing>
                        <step>
                            <type>XMLPATH</type>
                            <parameters>
                                <parameter>//NewX_AVM-DE_Provider/text()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>X_AVM-DE_GetActiveProvider</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/wancommonifconfig1</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:WANCommonInterfaceConfig:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>901fbfae5df040569fab9a88a96f69d0</uuid>
                    <name>WANDSLConfig-Diagnose</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.wandslconfig.diagnose</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>Get diagnose for DSL configuration.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>X_AVM-DE_GetDSLDiagnoseInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/wandslifconfig1</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:WANDSLInterfaceConfig:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>18b5046436de48ca9c49f45fb6431862</uuid>
                    <name>WANDSLConfig-GetDSLInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.wandslconfig.getdslinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>GetDSLInfo from DSL configuration.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>X_AVM-DE_GetDSLInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/wandslifconfig1</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:WANDSLInterfaceConfig:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>4950f20ebf634795b21b8b7d8e7a7f05</uuid>
                    <name>WANDSLConfig-GetStatistics</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.wandslconfig.getstatistics</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>Get statistics from DSL configuration.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetStatisticsTotal</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/wandslifconfig1</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:WANDSLInterfaceConfig:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>910d051d18ef4ef585ed426af05ecb62</uuid>
                    <name>Ethernet link status</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.wanethlinkconfig.status</key>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>Ethernet-Linkstatus.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetEthernetLinkStatusResponse.NewEthernetLinkStatus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetEthernetLinkStatus</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/wanethlinkconfig1</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:WANEthernetLinkConfig:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>72655bad5a2a4aeba63e3e8dddd2d1a7</uuid>
                    <name>Last connection error</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.wanipconfig.connectionerror</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewLastConnectionError</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.wanipconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>8a70c79eeb9e497b92bb4614fbbc644e</uuid>
                    <name>Connection status</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.wanipconfig.connectionstatus</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewConnectionStatus</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.wanipconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>715c91e4a96944bbb28cbc1bc80b2d46</uuid>
                    <name>Connection type</name>
                    <type>DEPENDENT</type>
                    <key>fritz.tr-064.wanipconfig.connectiontype</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Envelope.Body.GetInfoResponse.NewConnectionType</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>fritz.tr-064.wanipconfig.getinfo</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>6eb7dfe795194061a9c5c29ac28d1192</uuid>
                    <name>WANIPConfig-GetInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.wanipconfig.getinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>GetInfo about  IP based WAN connections.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/wanipconnection1</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:WANIPConnection:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>a463da82f865435baf64c5c0f600a478</uuid>
                    <name>WLANConfig-GetInfo</name>
                    <type>SCRIPT</type>
                    <key>fritz.tr-064.wlanconfig.getinfo</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>const params = JSON.parse(value);

var requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
'&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
'    &lt;s:Header&gt;' +
'        &lt;h:InitChallenge xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
'            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
'        &lt;/h:InitChallenge&gt;' +
'    &lt;/s:Header&gt;' +
'    &lt;s:Body&gt;' +
'        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
'    &lt;/s:Body&gt;' +
'&lt;/s:Envelope&gt;';

const action = params.urn + '#' + params.action;

// Initialize challenge with Fritz!Box
var url = 'http://' + params.ip + ':49000' + params.url;
const request = new HttpRequest();
request.addHeader('Content-Type: text/xml; charset=&quot;utf-8&quot;');
request.addHeader('User-Agent: AVM UPnP/1.0 Client 1.0');
request.addHeader('SoapAction: ' + action);
var response = request.post(url, requestBody);

var statusCode = request.getStatus();
if (statusCode != 200) {
    throw 'Error ' + statusCode + ' initializing authentication!';
} else {
    // Calculate authentication
    const nonce = XML.query(response, '//Nonce/text()');
    const realm = XML.query(response, '//Realm/text()');
    const secret = md5(params.username + ':' + realm + ':' + params.password);
    const auth = md5(secret + ':' + nonce);

    // Get values with authentication
    requestBody = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;' +
    '&lt;s:Envelope s:encodingStyle=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;' +
    '    &lt;s:Header&gt;' +
    '        &lt;h:ClientAuth xmlns:h=&quot;http://soap-authentication.org/digest/2001/10/&quot; s:mustUnderstand=&quot;1&quot;&gt;' +
    '            &lt;Nonce&gt;' + nonce + '&lt;/Nonce&gt;' +
    '            &lt;Auth&gt;' + auth + '&lt;/Auth&gt;' +
    '            &lt;UserID&gt;' + params.username + '&lt;/UserID&gt;' +
    '            &lt;Realm&gt;' + realm + '&lt;/Realm&gt;' +
    '        &lt;/h:ClientAuth&gt;' +
    '    &lt;/s:Header&gt;' +
    '    &lt;s:Body&gt;' +
    '        &lt;u:' + params.action + ' xmlns:u=&quot;' + params.urn + '&quot; /&gt;' +
    '    &lt;/s:Body&gt;' +
    '&lt;/s:Envelope&gt;';

    response = request.post(url, requestBody);
    var statusCode = request.getStatus();
    if (statusCode != 200) {
        throw 'Error ' + statusCode + ' sending authenticated request!';
    } else {
        return(response);
    }
}</params>
                    <description>GetInfo about  WLAN configurations.</description>
                    <preprocessing>
                        <step>
                            <type>XML_TO_JSON</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>action</name>
                            <value>GetInfo</value>
                        </parameter>
                        <parameter>
                            <name>ip</name>
                            <value>{HOST.IP}</value>
                        </parameter>
                        <parameter>
                            <name>password</name>
                            <value>{$FRITZ.PASSWORD}</value>
                        </parameter>
                        <parameter>
                            <name>url</name>
                            <value>/upnp/control/wlanconfig1</value>
                        </parameter>
                        <parameter>
                            <name>urn</name>
                            <value>urn:dslforum-org:service:WLANConfiguration:1</value>
                        </parameter>
                        <parameter>
                            <name>username</name>
                            <value>{$FRITZ.USERNAME}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>check</tag>
                            <value>TR-064</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <macros>
                <macro>
                    <macro>{$FRITZ.PASSWORD}</macro>
                    <type>SECRET_TEXT</type>
                    <description>Password in FritzBox!</description>
                </macro>
                <macro>
                    <macro>{$FRITZ.USERNAME}</macro>
                    <description>Username in FritzBox!</description>
                </macro>
            </macros>
        </template>
    </templates>
    <graphs>
        <graph>
            <uuid>f9790a03ba5d42debd53cae241cdacc8</uuid>
            <name>Devices</name>
            <type>STACKED</type>
            <graph_items>
                <graph_item>
                    <color>F7941D</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.guest</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.inactive</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>199C0D</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.active</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>3</sortorder>
                    <color>2774A4</color>
                    <calc_fnc>MIN</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.lua.devices.online</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
        <graph>
            <uuid>f621cdc7edea41e3a20b74ab4b6420ee</uuid>
            <name>Up- / Downstream</name>
            <graph_items>
                <graph_item>
                    <color>199C0D</color>
                    <calc_fnc>ALL</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.tr-064.downstream</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>F63100</color>
                    <calc_fnc>ALL</calc_fnc>
                    <item>
                        <host>FritzBox UPNP</host>
                        <key>fritz.tr-064.upstream</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
